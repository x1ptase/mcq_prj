<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Algorithm Complexity Quiz - Instant & Refresh</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-wrapper">
        <header>
            <h1>COMPLEXITY OF ALGORITHMS</h1>
            <div class="control-panel">
                <button onclick="refreshQuiz()" class="btn-refresh-top">üîÑ L√†m m·ªõi b√†i thi</button>
            </div>
        </header>

        <div id="quiz-container">ƒêang t·∫£i c√¢u h·ªèi...</div>
    </div>

    <script>
        let questions = [];

        // T·∫£i c√¢u h·ªèi l·∫ßn ƒë·∫ßu
        async function load() {
            try {
                const res = await fetch('/get-questions');
                questions = await res.json();
                render();
            } catch (e) { document.getElementById('quiz-container').innerText = "L·ªói t·∫£i d·ªØ li·ªáu!"; }
        }

        // H√†m Reset to√†n b·ªô b√†i
        function refreshQuiz() {
            // Hi·ªáu ·ª©ng x√°c nh·∫≠n nh·∫π
            if(confirm("B·∫°n c√≥ mu·ªën x√≥a h·∫øt k·∫øt qu·∫£ v√† l√†m l·∫°i t·ª´ ƒë·∫ßu kh√¥ng?")) {
                render(); // V·∫Ω l·∫°i giao di·ªán t·ª´ m·∫£ng questions ƒë√£ l∆∞u
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function render() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = questions.map((q, i) => {
                const isMulti = q.correct_answer.trim().length > 1;
                
                // Ki·ªÉm tra xem q.question c√≥ ph·∫£i l√† t√™n file ·∫£nh (.png, .jpg, .svg) kh√¥ng
                const isImageQuestion = q.question.match(/\.(jpeg|jpg|gif|png|svg)$/i);
                
                // N·∫øu l√† ·∫£nh, t·∫°o th·∫ª <img>, n·∫øu kh√¥ng th√¨ hi·ªÉn th·ªã ch·ªØ b√¨nh th∆∞·ªùng
                const questionContent = isImageQuestion 
                    ? `<div class="image-question">
                        <p class="q-num">Question ${i+1}:</p>
                        <img src="/img/${q.question}" alt="Question Image" class="main-q-img">
                    </div>`
                    : `<div class="q-text">Question ${i+1}: ${q.question}</div>`;

                return `
                <div class="quiz-card" id="card-${q.id}">
                    ${questionContent}

                    <div class="options">
                        ${['A','B','C','D'].map(l => `
                            <label class="opt">
                                <input type="${isMulti ? 'checkbox' : 'radio'}" 
                                    name="q${q.id}" 
                                    value="${l}" 
                                    onchange="checkInstant(${q.id}, '${l}')">
                                <div class="box"><b>${l}.</b> ${q['option_'+l.toLowerCase()]}</div>
                            </label>
                        `).join('')}
                    </div>
                    <div id="msg-${q.id}" class="feedback-msg"></div>
                </div>`;
            }).join('');
        }

        // Logic checkInstant gi·ªØ nguy√™n nh∆∞ y√™u c·∫ßu tr∆∞·ªõc c·ªßa b·∫°n
        function checkInstant(qId, label) {
            const question = questions.find(q => q.id === qId);
            const card = document.getElementById(`card-${qId}`);
            const msg = document.getElementById(`msg-${qId}`);
            const correctAns = question.correct_answer.trim().toUpperCase();
            
            const selectedInputs = Array.from(card.querySelectorAll(`input[name="q${qId}"]:checked`));
            const selectedStr = selectedInputs.map(i => i.value).sort().join('');

            card.querySelectorAll('.box').forEach(b => b.classList.remove('correct', 'wrong'));

            if (correctAns.length === 1) {
                const selectedInput = card.querySelector(`input[name="q${qId}"]:checked`);
                const box = selectedInput.nextElementSibling;
                if (selectedStr === correctAns) {
                    box.classList.add('correct');
                    msg.innerHTML = "Ch√≠nh x√°c! ‚úîÔ∏è";
                    msg.style.color = "green";
                } else {
                    box.classList.add('wrong');
                    msg.innerHTML = `Sai r·ªìi. ƒê√°p √°n ƒë√∫ng: ${correctAns}`;
                    msg.style.color = "red";
                }
                card.querySelectorAll('input').forEach(i => i.disabled = true);
            } else {
                if (selectedStr.length === correctAns.length) {
                    if (selectedStr === correctAns) {
                        selectedInputs.forEach(i => i.nextElementSibling.classList.add('correct'));
                        msg.innerHTML = "Ch√≠nh x√°c! ‚úîÔ∏è";
                        msg.style.color = "green";
                    } else {
                        selectedInputs.forEach(i => i.nextElementSibling.classList.add('wrong'));
                        msg.innerHTML = `Sai r·ªìi. ƒê√°p √°n ƒë√∫ng: ${correctAns}`;
                        msg.style.color = "red";
                    }
                    card.querySelectorAll('input').forEach(i => i.disabled = true);
                } else {
                    msg.innerHTML = `H√£y ch·ªçn ƒë·ªß ${correctAns.length} ƒë√°p √°n...`;
                    msg.style.color = "orange";
                }
            }
        }

        window.onload = load;
    </script>
</body>
</html>